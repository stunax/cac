
def evolve(timesteps, n, H, U, V, Hx, Hy, Ux, Uy, Vx, Vy, dx, dy, dt):

    g = 9.81

    for i in xrange(timesteps):
        
        # Reflecting boundary conditions
        H[:, 0] = H[:, 1]
        U[:, 0] = U[:, 1]
        V[:, 0] = -V[:, 1]
        H[:, n + 1] = H[:, n]
        U[:, n + 1] = U[:, n]
        V[:, n + 1] = -V[:, n]
        H[0, :] = H[1, :]
        U[0, :] = -U[1, :]
        V[0, :] = V[1, :]
        H[n + 1, :] = H[n, :]
        U[n + 1, :] = -U[n, :]
        V[n + 1, :] = V[n, :]

        # First half step

        # height

        Hx[:, :-1] = (H[1:, 1:-1] + H[:-1, 1:-1]) / 2 - dt / (2 * dx) \
            * (U[1:, 1:-1] - U[:-1, 1:-1])

        # x momentum

        Ux[:, :-1] = (U[1:, 1:-1] + U[:-1, 1:-1]) / 2 - dt / (2 * dx) \
            * (U[1:, 1:-1] ** 2 / H[1:, 1:-1] + g / 2 * H[1:, 1:-1]
               ** 2 - (U[:-1, 1:-1] ** 2 / H[:-1, 1:-1] + g / 2 * H[:
               -1, 1:-1] ** 2))

        # y momentum

        Vx[:, :-1] = (V[1:, 1:-1] + V[:-1, 1:-1]) / 2 - dt / (2 * dx) \
            * (U[1:, 1:-1] * V[1:, 1:-1] / H[1:, 1:-1] - U[:-1, 1:-1]
               * V[:-1, 1:-1] / H[:-1, 1:-1])

        # height

        Hy[:-1, :] = (H[1:-1, 1:] + H[1:-1, :-1]) / 2 - dt / (2 * dy) \
            * (V[1:-1, 1:] - V[1:-1, :-1])

        # x momentum

        Uy[:-1, :] = (U[1:-1, 1:] + U[1:-1, :-1]) / 2 - dt / (2 * dy) \
            * (V[1:-1, 1:] * U[1:-1, 1:] / H[1:-1, 1:] - V[1:-1, :-1]
               * U[1:-1, :-1] / H[1:-1, :-1])

        # y momentum

        Vy[:-1, :] = (V[1:-1, 1:] + V[1:-1, :-1]) / 2 - dt / (2 * dy) \
            * (V[1:-1, 1:] ** 2 / H[1:-1, 1:] + g / 2 * H[1:-1, 1:]
               ** 2 - (V[1:-1, :-1] ** 2 / H[1:-1, :-1] + g / 2 * H[1:
               -1, :-1] ** 2))

        # Second half step

        # height

        H[1:-1, 1:-1] = H[1:-1, 1:-1] - dt / dx * (Ux[1:, :-1] - Ux[:
                -1, :-1]) - dt / dy * (Vy[:-1, 1:] - Vy[:-1, :-1])

        # x momentum

        U[1:-1, 1:-1] = U[1:-1, 1:-1] - dt / dx * (Ux[1:, :-1] ** 2
                / Hx[1:, :-1] + g / 2 * Hx[1:, :-1] ** 2 - (Ux[:-1, :
                -1] ** 2 / Hx[:-1, :-1] + g / 2 * Hx[:-1, :-1] ** 2)) \
            - dt / dy * (Vy[:-1, 1:] * Uy[:-1, 1:] / Hy[:-1, 1:] - Vy[:
                         -1, :-1] * Uy[:-1, :-1] / Hy[:-1, :-1])

        # y momentum

        V[1:-1, 1:-1] = V[1:-1, 1:-1] - dt / dx * (Ux[1:, :-1] * Vx[1:,
                :-1] / Hx[1:, :-1] - Ux[:-1, :-1] * Vx[:-1, :-1] / Hx[:
                -1, :-1]) - dt / dy * (Vy[:-1, 1:] ** 2 / Hy[:-1, 1:]
                + g / 2 * Hy[:-1, 1:] ** 2 - (Vy[:-1, :-1] ** 2 / Hy[:
                -1, :-1] + g / 2 * Hy[:-1, :-1] ** 2))

